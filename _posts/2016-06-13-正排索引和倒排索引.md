---
layout: post
title: 正排索引和倒排索引
categories: [Elasticsearch]
description: Elasticsearch 在实际中的作用是越来越强了
keywords: Elasticsearch
---

# 正排索引和倒排索引
正排索引是从文档到关键字的映射（已知文档求关键字），倒排索引是从关键字到文档的映射（已知关键字求文档）


## 正排索引（正向索引）
正排表是以文档的ID为关键字，表中记录文档中每个单词的位置信息，查找时扫描表中每个文档中字的信息直到找出所有包含查询关键字的文档。

正排表结构如图1所示，这种组织方法在建立索引的时候结构比较简单，建立比较方便且易于维护;因为索引是基于文档建立的，若是有新的文档加入，直接为该文档建立一个新的索引块，挂接在原来索引文件的后面。若是有文档删除，则直接找到该文档号文档对应的索引信息，将其直接删除。但是在查询的时候需对所有的文档进行扫描以确保没有遗漏，这样就使得检索时间大大延长，检索效率低下。     

尽管正排表的工作原理非常的简单，但是由于其检索效率太低，除非在特定情况下，否则实用性价值不大。

<center>![](http://img.blog.csdn.net/20150923103812886?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)</center>

## 倒排索引（反向索引）
倒排表以单词或者短语为关键字进行索引，表中记录关键字在所有文档中出现的文档编号和位置.

由于每个字或词对应的文档数量在动态变化，所以倒排表的建立和维护都较为复杂，但是在查询的时候由于可以一次得到查询关键字所对应的所有文档，所以效率高于正排表。在全文检索中，检索的快速响应是一个最为关键的性能，而索引建立由于在后台进行，尽管效率相对低一些，但不会影响整个搜索引擎的效率。

<center>![](http://img.blog.csdn.net/20150923103845777?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)</center>

## 倒排序索引实例
有两种不同的反向索引形式：

- 一条记录的水平反向索引（或者反向档案索引）包含每个引用单词的文档的列表。
- 一个单词的水平反向索引（或者完全反向索引）又包含每个单词在一个文档中的位置。

后者的形式提供了更多的兼容性（比如短语搜索），但是需要更多的时间和空间来创建。

### 例子
以英文为例，下面是要被索引的文本：

```
T0 = "it is what it is"
T1 = "what is it"
T2 ="it is a banana"
```

我们就能得到下面的反向文件索引：

```
"a":      {2}
"banana": {2}
"is":     {0, 1, 2}
"it":     {0, 1, 2}
"what":   {0, 1}
```

检索的条件`"what"`, `"is"` 和 `"it"` 将对应这个集合：$\lbrace0,1\rbrace \bigcap \lbrace0,1,2\rbrace \bigcap \lbrace0,1,2\rbrace = \lbrace0,1\rbrace$

对相同的文字，我们得到后面这些完全反向索引，有文档数量和当前查询的单词结果组成的的成对数据。 

同样，文档数量和当前查询的单词结果都从零开始。所以`"banana": {(2, 3)}`, 就是说 `"banana"`在第三个文档 **T2** 里 ，而且在第三个文档 **T2** 的位置是第四个单词(地址为 3)。

```
"a":      {(2, 2)}
"banana": {(2, 3)}
"is":     {(0, 1), (0, 4), (1, 1), (2, 1)}
"it":     {(0, 0), (0, 3), (1, 2), (2, 0)} 
"what":   {(0, 2), (1, 0)}
```

如果我们执行短语搜索`"what is it"` 我们得到这个短语的全部单词各自的结果所在文档为文档 **T0**和文档 **T1**。但是这个短语检索的连续的条件仅仅在文档1得到。

## 参考
1. [正排索引和倒排索引](http://blog.csdn.net/zhangzeyuaaa/article/details/48676775)
2. [倒排索引](https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95)