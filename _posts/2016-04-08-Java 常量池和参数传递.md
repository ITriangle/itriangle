---
layout: post
title: Java 常量池和参数传递
categories: [Java]
description: Java 常量池和参数传递间的方式有着千丝万缕的联系.
keywords: Java
---

# Java 常量池

## 一.常量

### 1.用户自定义常量
用final修饰的成员变量表示常量，值一旦初始化就无法改变！

final修饰的变量有三种：静态变量、实例变量和局部变量，分别表示三种类型的常量。

### 2.Class文件中的常量
字面量(Literal)和符号引用量(Symbolic References).**字面量**相当于Java语言层面常量的概念，如文本字符串，声明为final的常量值等;**符号引用**则属于编译原理方面的概念，包括了如下三种类型的常量：

- 类和接口的全限定名
- 字段名称和描述符
- 方法名称和描述符

## 二.常量池

### 1.Class文件中的常量池
在Class文件结构中，最头的4个字节用于存储魔数Magic Number，用于确定一个文件是否能被JVM接受，再接着4个字节用于存储版本号，前2个字节存储次版本号，后2个存储主版本号，再接着是用于存放常量的常量池，由于常量的数量是不固定的，所以常量池的入口放置一个U2类型的数据(constant_pool_count)存储常量池容量计数值。

Class文件中的常量池主要用于存放两大类常量：字面量(Literal)和符号引用量(Symbolic References).

### 2.方法区中的运行时常量池
运行时常量池是方法区的一部分.运行时常量池相对于CLass文件常量池的另外一个重要特征是具备动态性，Java语言并不要求常量一定只有编译期才能产生，也就是并非预置入CLass文件中常量池的内容才能进入方法区运行时常量池，运行期间也可能将新的常量放入池中，这种特性被开发人员利用比较多的就是String类的intern()方法。

### 3.常量池优点
常量池是为了避免频繁的创建和销毁对象而影响系统性能，其实现了对象的共享。
例如字符串常量池，在编译阶段就把所有的字符串文字放到一个常量池中。

1. 节省内存空间：常量池中所有相同的字符串常量被合并，只占用一个空间。
2. 节省运行时间：比较字符串时，==比equals()快。对于两个引用变量，只用==判断引用是否相等，也就可以判断实际值是否相等。

### 4.补充:双等号==的含义

1. 基本数据类型之间应用双等号，比较的是他们的数值
2. 复合数据类型(类)之间应用双等号，比较的是他们在内存中的存放地址

## 三.8种基本类型的包装类和常量池

### 1.实现常量池的包装类:Byte,Short,Integer,Long,Character,Boolean
这5种包装类默认创建了数值[-128，127]的相应类型的缓存数据，但是超出此范围仍然会去创建新的对象。

### 2.未实现常量池的包装类:Float,Double
常量池的是把双刃剑,适合的是高频率的对象.所以会控制范围,Float,Double没有实现常量池也是可以理解的.

### 3.实例辨析

```java
Integer i1 = 40;
Integer i2 = 40;
Integer i3 = 0;
Integer i4 = new Integer(40);
Integer i5 = new Integer(40);
Integer i6 = new Integer(0);

System.out.println("i1=i2   " + (i1 == i2));
System.out.println("i1=i2+i3   " + (i1 == i2 + i3));
System.out.println("i1=i4   " + (i1 == i4));
System.out.println("i4=i5   " + (i4 == i5));
System.out.println("i4=i5+i6   " + (i4 == i5 + i6));   
System.out.println("40=i5+i6   " + (40 == i5 + i6));
```

输出

```
i1=i2   true
i1=i2+i3   true
i1=i4   false
i4=i5   false
i4=i5+i6   true
40=i5+i6   true
```

**分析:**

1. 语句`i4 == i5 + i6`，因为+这个操作符不适用于`Integer`对象，首先`i5`和`i6`进行自动拆箱操作，进行数值相加，即`i4 == 40`。然后`Integer`对象无法与数值进行直接比较，所以`i4`自动拆箱转为`int`值`40`，最终这条语句转为`40 == 40`进行数值比较。
2. `new Integer(40)` 是创建一个新的对象,无论常量池中是否存在.

## 四.String类和常量池
字符串类分为三个:

1. String 类:对象不可改变,赋值时先到字符串常量池中查询,若没有则生成新的对象加入常量池.
2. StringBuffer 类:可改变,线程安全
3. StringBulid 类:可改变,非线程安全,速度较 StringBuffer 快.

我们这里讨论的是 String 类.

# 参数传递
参数传递就是给变量赋值的过程.变量分为基础类型变量和引用类型变量.

## 一.基本类型
基本类型的变量赋值就是值得拷贝.

基本类型作为参数传递时，是传递值的拷贝，无论你怎么改变这个拷贝，原值是不会改变的.这个没有争议,是同C/C++的.

## 二.复合类型
复合类型,参数传递时引用变量的赋值,传递的是引用对象的地址.

### 1.String 类特例
针对上文 String类的特殊性,在赋值时,会生成新的对象.所以,原始String 对象的值不会改变.

###2.其他复合类型
其他复合类型都是传递的对象的引用,改变该引用对象的值,原对象都会一起改变.

除了,使用 `new` 或者赋值其他对象的引用,切断与原始对象的引用才不会对原始对象有影响.

但是,Java 还是建议使用函数返回的方式更新原始对象.


## 参考
1. [Java常量池理解与总结](http://www.jianshu.com/p/c7f47de2ee80)
2. [java参数传递](http://blog.sina.com.cn/s/blog_4b622a8e0100c1bo.html)